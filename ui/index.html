<html>
    <head>
        <title>Pi</title>
        <script src="lib/quagga.min.js"></script>
        <script src="./productSearch.js"></script>
        <style>
            @media (orientation: landscape) {
                video {
                    height: 60%;
                }
            }
            @media (orientation: portrait) {
                video {
                    width: 100%;
                }
            }
        </style>
    </head>
    <body>
        <div>
            <h1 id="flags">Flags</>
        </div>
        <div id="qr-reader"></div>
    </body>
    <script>
        Quagga.init(
            {
                numOfWorkers: 4,
                debug: true,
                locate: true,
                inputStream: {
                    name: 'Live',
                    type: 'LiveStream',
                    target: document.querySelector('#qr-reader'), // Or '#yourElement' (optional)
                },
                decoder: {
                    readers: ['upc_reader'],
                    debug: {
                        drawBoundingBox: true,
                        drawScanline: true,
                    },
                },
            },
            function (err) {
                if (err) {
                    console.log(err);
                    return;
                }
                Quagga.start();
            }
        );

        var lastDetection;
        Quagga.onDetected(function (result) {
            var code = result.codeResult.code;
            if (code == null || code == lastDetection) {
                return;
            }
            lastDetection = code;
            fetch('https://world.openfoodfacts.org/api/v0/product/' + code)
                .then((response) => response.json())
                .then((json) => {
                    let warningIngredients = parseProductData(json);
                    if (warningIngredients != null) {
                        document.getElementById('flags').innerText =
                            warningIngredients;
                    }
                });
            // fetch('https://nftstorage.link/ipfs/' + UPC[code].ipfs)
            //     .then((response) => response.json())
            //     .then((json) => {
            //         document.getElementById('company').innerText = json.name;
            //         document.getElementById('score').innerText = json.score;
            //         document.getElementById('blurb').innerText = json.blurb;
            //     });
        });
    </script>
</html>
