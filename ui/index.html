<html>
    <head>
        <title>Pi</title>
        <script src="lib/quagga.min.js"></script>
    </head>
    <body>
        <div id="qr-reader" style="width: 100vw; height:70vh"></div>
        <div>
            <h1 id="company">Company</h1>
            <h2 id="score">Score</h2>
            <p id="blurb">Blurb</p>
        </div>
    </body>
    <script>
        var UPC;
        console.log(window.innerWidth)
        fetch('UPC.json')
            .then((response) => response.json())
            .then((json) => UPC = json);
        Quagga.init(
            {
                numOfWorkers: 4,
                inputStream: {
                    name: 'Live',
                    type: 'LiveStream',
                    target: document.querySelector('#qr-reader'), // Or '#yourElement' (optional)
                },
                decoder: {
                    readers: ['upc_reader'],
                },
            },
            function (err) {
                if (err) {
                    console.log(err);
                    return;
                }
                console.log('Initialization finished. Ready to start');
                Quagga.start();
            }
        );
        Quagga.onDetected(function (result) {
            var code = result.codeResult.code;
            if(!(code in UPC)) {
                console.log("bad read");
                return;
            }
            console.log(code);
            console.log(UPC[code].company);
            fetch("https://nftstorage.link/ipfs/" + UPC[code].ipfs)
            .then((response) => response.json())
            .then((json) => {
                document.getElementById("company").innerText=json.name;
                document.getElementById("score").innerText=json.score;
                document.getElementById("blurb").innerText = json.blurb;
            });
        });
    </script>
</html>
